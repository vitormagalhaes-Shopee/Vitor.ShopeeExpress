<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Logistics Intelligence Dashboard</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-gray-100">

<!-- LOADER -->
<div id="loader" class="fixed inset-0 bg-white flex items-center justify-center z-50">
  <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
</div>

<!-- APP -->
<div id="app" class="hidden">

  <!-- HEADER -->
  <header class="bg-white shadow px-6 py-4 flex justify-between items-center">
    <h1 class="font-bold text-lg">LOGISTICS INTELLIGENCE</h1>

    <div class="flex gap-2">
      <select class="border rounded px-2 py-1 text-sm"><option>HUB</option></select>
      <select class="border rounded px-2 py-1 text-sm"><option>CICLO</option></select>
      <select class="border rounded px-2 py-1 text-sm"><option>TRANSPORTADORA</option></select>
      <select class="border rounded px-2 py-1 text-sm"><option>PERFIL</option></select>
    </div>
  </header>

  <!-- KPIs -->
  <section class="grid grid-cols-1 md:grid-cols-4 gap-4 p-6">
    <div class="bg-white rounded-xl p-4 border-l-4 border-red-500">
      <p class="text-sm text-gray-500">FROTA TOTAL</p>
      <p id="kpiTotal" class="text-3xl font-bold">0</p>
    </div>

    <div class="bg-white rounded-xl p-4 border-l-4 border-blue-500">
      <p class="text-sm text-gray-500">VE√çCULOS POR TRANSPORTADORA</p>
      <p id="kpiTransportadora" class="text-3xl font-bold">0</p>
    </div>

    <div class="bg-white rounded-xl p-4 border-l-4 border-indigo-500">
      <p class="text-sm text-gray-500">VE√çCULOS POR MODAL</p>
      <p id="kpiModal" class="text-3xl font-bold">0</p>
    </div>

    <div class="bg-white rounded-xl p-4">
      <p class="text-sm text-gray-500">√öLTIMA SYNC</p>
      <p class="text-xl font-bold" id="lastSync">--:--:--</p>
    </div>
  </section>

  <!-- GR√ÅFICO EVOLU√á√ÉO -->
  <section class="bg-white mx-6 rounded-xl p-6 shadow">
    <div class="flex justify-between items-center mb-4">
      <h2 class="font-semibold">EVOLU√á√ÉO DI√ÅRIA (√öLTIMOS DIAS)</h2>
      <select class="border rounded px-2 py-1 text-sm">
        <option>7 dias</option>
        <option>15 dias</option>
        <option>30 dias</option>
      </select>
    </div>

    <canvas id="evolucaoChart" height="120"></canvas>
    <p id="evolucaoEmpty" class="text-center text-gray-400 mt-6 hidden">
      Nenhum dado dispon√≠vel para o per√≠odo selecionado
    </p>
  </section>

  <!-- GR√ÅFICOS INFERIORES -->
  <section class="grid grid-cols-1 md:grid-cols-2 gap-6 p-6">
    <div class="bg-white rounded-xl p-6 shadow">
      <h2 class="font-semibold mb-4">PERFIL DE VE√çCULO</h2>
      <canvas id="perfilChart"></canvas>
    </div>

    <div class="bg-white rounded-xl p-6 shadow">
      <h2 class="font-semibold mb-4">MARKET SHARE PARCEIROS</h2>
      <canvas id="marketChart"></canvas>
    </div>
  </section>

</div>

<!-- SCRIPT -->
<script>
/* ===== LOADER ===== */
function showLoader() {
  document.getElementById("loader").classList.remove("hidden");
}

function hideLoader() {
  document.getElementById("loader").classList.add("hidden");
  document.getElementById("app").classList.remove("hidden");
}

/* ===== MOCK DE DADOS (SEGURAN√áA) ===== */
async function loadData() {
  return {
    total: 0,
    transportadora: 0,
    modal: 0,
    evolucao: [],
    perfil: [],
    market: []
  };
}

/* ===== RENDER ===== */
function renderKPIs(data) {
  document.getElementById("kpiTotal").innerText = data.total;
  document.getElementById("kpiTransportadora").innerText = data.transportadora;
  document.getElementById("kpiModal").innerText = data.modal;
  document.getElementById("lastSync").innerText = new Date().toLocaleTimeString();
}

function renderEvolucao(data) {
  if (!data.length) {
    document.getElementById("evolucaoEmpty").classList.remove("hidden");
    return;
  }

  new Chart(document.getElementById("evolucaoChart"), {
    type: "line",
    data: {
      labels: data.map(d => d.label),
      datasets: [{
        data: data.map(d => d.value),
        borderWidth: 2
      }]
    }
  });
}

function renderPizza(id, data) {
  new Chart(document.getElementById(id), {
    type: "doughnut",
    data: {
      labels: data.map(d => d.label),
      datasets: [{
        data: data.map(d => d.value)
      }]
    }
  });
}

/* ===== INIT ===== */
async function initDashboard() {
  showLoader();

  try {
    const data = await loadData();
    renderKPIs(data);
    renderEvolucao(data.evolucao);
    renderPizza("perfilChart", data.perfil.length ? data.perfil : [{ label: "Sem dados", value: 1 }]);
    renderPizza("marketChart", data.market.length ? data.market : [{ label: "Sem dados", value: 1 }]);
  } catch (e) {
    console.error("Erro no dashboard:", e);
  } finally {
    hideLoader(); // üî• IMPOSS√çVEL FICAR EM LOAD INFINITO
  }
}

document.addEventListener("DOMContentLoaded", initDashboard);
</script>

</body>
</html>
